# HELLO
- The Word doc is named Architectures_Designs.docx.
- The Word doc to Markdown is translated below.  However, I suggest opening the Word doc.

Thank you!

Willie Sandoval

# Markdown starts below.....


  <!-- /\* Font Definitions \*/ @font-face {font-family:Helvetica; panose-1:2 11 6 4 2 2 2 2 2 4;} @font-face {font-family:Courier; panose-1:2 7 4 9 2 2 5 2 4 4;} @font-face {font-family:"Tms Rmn"; panose-1:2 2 6 3 4 5 5 2 3 4;} @font-face {font-family:Helv; panose-1:2 11 6 4 2 2 2 3 2 4;} @font-face {font-family:"New York"; panose-1:2 4 5 3 6 5 6 2 3 4;} @font-face {font-family:System; panose-1:0 0 0 0 0 0 0 0 0 0;} @font-face {font-family:Wingdings; panose-1:5 0 0 0 0 0 0 0 0 0;} @font-face {font-family:"MS Mincho"; panose-1:2 2 6 9 4 2 5 8 3 4;} @font-face {font-family:Batang; panose-1:2 3 6 0 0 1 1 1 1 1;} @font-face {font-family:SimSun; panose-1:2 1 6 0 3 1 1 1 1 1;} @font-face {font-family:PMingLiU; panose-1:2 1 6 1 0 1 1 1 1 1;} @font-face {font-family:"MS Gothic"; panose-1:2 11 6 9 7 2 5 8 2 4;} @font-face {font-family:Dotum; panose-1:2 11 6 0 0 1 1 1 1 1;} @font-face {font-family:SimHei; panose-1:2 1 6 0 3 1 1 1 1 1;} @font-face {font-family:MingLiU; panose-1:2 1 6 9 0 1 1 1 1 1;} @font-face {font-family:Mincho; panose-1:2 2 6 9 4 3 5 8 3 5;} @font-face {font-family:Gulim; panose-1:2 11 6 0 0 1 1 1 1 1;} @font-face {font-family:Century; panose-1:2 4 6 4 5 5 5 2 3 4;} @font-face {font-family:"Angsana New"; panose-1:2 2 6 3 5 4 5 2 3 4;} @font-face {font-family:"Cordia New"; panose-1:2 11 3 4 2 2 2 2 2 4;} @font-face {font-family:Mangal; panose-1:0 0 4 0 0 0 0 0 0 0;} @font-face {font-family:Latha; panose-1:2 0 4 0 0 0 0 0 0 0;} @font-face {font-family:Sylfaen; panose-1:1 10 5 2 5 3 6 3 3 3;} @font-face {font-family:Vrinda; panose-1:0 0 4 0 0 0 0 0 0 0;} @font-face {font-family:Raavi; panose-1:2 0 5 0 0 0 0 0 0 0;} @font-face {font-family:Shruti; panose-1:2 0 5 0 0 0 0 0 0 0;} @font-face {font-family:Sendnya; panose-1:0 0 4 0 0 0 0 0 0 0;} @font-face {font-family:Gautami; panose-1:2 0 5 0 0 0 0 0 0 0;} @font-face {font-family:Tunga; panose-1:0 0 4 0 0 0 0 0 0 0;} @font-face {font-family:"Estrangelo Edessa"; panose-1:0 0 0 0 0 0 0 0 0 0;} @font-face {font-family:"Cambria Math"; panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face {font-family:"Yu Gothic"; panose-1:2 11 4 0 0 0 0 0 0 0;} @font-face {font-family:DengXian; panose-1:2 1 6 0 3 1 1 1 1 1;} @font-face {font-family:Calibri; panose-1:2 15 5 2 2 2 4 3 2 4;} @font-face {font-family:"Calibri Light"; panose-1:2 15 3 2 2 2 4 3 2 4;} @font-face {font-family:"Palatino Linotype"; panose-1:2 4 5 2 5 5 5 3 3 4;} @font-face {font-family:Verdana; panose-1:2 11 6 4 3 5 4 4 2 4;} @font-face {font-family:"Arial Unicode MS"; panose-1:2 11 6 4 2 2 2 2 2 4;} @font-face {font-family:Aptos;} @font-face {font-family:"Aptos Display";} @font-face {font-family:"Segoe UI Emoji"; panose-1:2 11 5 2 4 2 4 2 2 3;} @font-face {font-family:Consolas; panose-1:2 11 6 9 2 2 4 3 2 4;} /\* Style Definitions \*/ p.MsoNormal, li.MsoNormal, div.MsoNormal {margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} h1 {mso-style-link:"Heading 1 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; line-height:107%; page-break-before:always; page-break-after:avoid; font-size:16.0pt; font-family:"Calibri Light",sans-serif; color:#2F5496; font-weight:normal;} h2 {mso-style-link:"Heading 2 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.1in; line-height:115%; page-break-after:avoid; font-size:13.0pt; font-family:"Calibri Light",sans-serif; color:#C45911; font-weight:normal;} h3 {mso-style-link:"Heading 3 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.2in; line-height:107%; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri",sans-serif; color:#A8D08D; font-weight:normal;} h4 {mso-style-link:"Heading 4 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.3in; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri Light",sans-serif; color:#7030A0; font-weight:normal; font-style:italic;} h5 {mso-style-link:"Heading 5 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.6in; line-height:107%; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri Light",sans-serif; color:#2F5496; font-weight:normal;} h6 {mso-style-link:"Heading 6 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.7in; line-height:107%; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri Light",sans-serif; color:#00B0F0; font-weight:normal;} p.MsoHeading7, li.MsoHeading7, div.MsoHeading7 {mso-style-link:"Heading 7 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.8in; line-height:107%; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri Light",sans-serif; color:#92D050; font-style:italic;} p.MsoHeading8, li.MsoHeading8, div.MsoHeading8 {mso-style-link:"Heading 8 Char"; margin-top:2.0pt; margin-right:0in; margin-bottom:0in; margin-left:.6in; line-height:107%; page-break-after:avoid; font-size:10.5pt; font-family:"Calibri Light",sans-serif; color:#FFC000;} p.MsoHeading9, li.MsoHeading9, div.MsoHeading9 {mso-style-link:"Heading 9 Char"; margin:0in; line-height:107%; page-break-after:avoid; font-size:11.0pt; font-family:"Calibri",sans-serif; color:#272727;} p.MsoToc1, li.MsoToc1, div.MsoToc1 {margin-top:12.0pt; margin-right:0in; margin-bottom:5.0pt; margin-left:0in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoToc2, li.MsoToc2, div.MsoToc2 {margin-top:12.0pt; margin-right:0in; margin-bottom:5.0pt; margin-left:11.0pt; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoToc3, li.MsoToc3, div.MsoToc3 {margin-top:12.0pt; margin-right:0in; margin-bottom:5.0pt; margin-left:22.0pt; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoTitle, li.MsoTitle, div.MsoTitle {mso-style-link:"Title Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; text-align:center; font-size:28.0pt; font-family:"Calibri Light",sans-serif; letter-spacing:-.5pt;} p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst {mso-style-link:"Title Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; text-align:center; font-size:28.0pt; font-family:"Calibri Light",sans-serif; letter-spacing:-.5pt;} p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle {mso-style-link:"Title Char"; margin:0in; text-align:center; font-size:28.0pt; font-family:"Calibri Light",sans-serif; letter-spacing:-.5pt;} p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast {mso-style-link:"Title Char"; margin:0in; text-align:center; font-size:28.0pt; font-family:"Calibri Light",sans-serif; letter-spacing:-.5pt;} p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle {mso-style-link:"Subtitle Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.35in; text-align:center; text-indent:-.25in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif; color:#5A5A5A; letter-spacing:.75pt;} a:link, span.MsoHyperlink {color:#0563C1; text-decoration:underline;} a:visited, span.MsoHyperlinkFollowed {color:#954F72; text-decoration:underline;} p {margin-right:0in; margin-left:0in; font-size:12.0pt; font-family:"Times New Roman",serif;} p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing {margin:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph {margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.5in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst {margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.5in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle {margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.5in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast {margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.5in; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.MsoQuote, li.MsoQuote, div.MsoQuote {mso-style-link:"Quote Char"; margin-top:8.0pt; margin-right:0in; margin-bottom:8.0pt; margin-left:0in; text-align:center; line-height:107%; font-size:11.0pt; font-family:"Calibri",sans-serif; color:#404040; font-style:italic;} p.MsoIntenseQuote, li.MsoIntenseQuote, div.MsoIntenseQuote {mso-style-link:"Intense Quote Char"; margin-top:.25in; margin-right:.6in; margin-bottom:.25in; margin-left:.6in; text-align:center; line-height:107%; border:none; padding:0in; font-size:11.0pt; font-family:"Calibri",sans-serif; color:#2F5496; font-style:italic;} span.MsoIntenseEmphasis {color:#2F5496; font-style:italic;} span.MsoIntenseReference {font-variant:small-caps; color:#2F5496; letter-spacing:.25pt; font-weight:bold;} p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading {margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; line-height:107%; page-break-after:avoid; font-size:16.0pt; font-family:"Calibri Light",sans-serif; color:#2F5496;} span.Heading3Char {mso-style-name:"Heading 3 Char"; mso-style-link:"Heading 3"; font-family:"Times New Roman",serif; color:#A8D08D;} p.Style1, li.Style1, div.Style1 {mso-style-name:Style1; mso-style-link:"Style1 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.Style1CxSpFirst, li.Style1CxSpFirst, div.Style1CxSpFirst {mso-style-name:Style1CxSpFirst; mso-style-link:"Style1 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.Style1CxSpMiddle, li.Style1CxSpMiddle, div.Style1CxSpMiddle {mso-style-name:Style1CxSpMiddle; mso-style-link:"Style1 Char"; margin:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.Style1CxSpLast, li.Style1CxSpLast, div.Style1CxSpLast {mso-style-name:Style1CxSpLast; mso-style-link:"Style1 Char"; margin:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} span.Style1Char {mso-style-name:"Style1 Char"; mso-style-link:Style1;} p.bullet, li.bullet, div.bullet {mso-style-name:bullet; mso-style-link:"bullet Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.35in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bulletCxSpFirst, li.bulletCxSpFirst, div.bulletCxSpFirst {mso-style-name:bulletCxSpFirst; mso-style-link:"bullet Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.35in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bulletCxSpMiddle, li.bulletCxSpMiddle, div.bulletCxSpMiddle {mso-style-name:bulletCxSpMiddle; mso-style-link:"bullet Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.35in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bulletCxSpLast, li.bulletCxSpLast, div.bulletCxSpLast {mso-style-name:bulletCxSpLast; mso-style-link:"bullet Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.35in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} span.bulletChar {mso-style-name:"bullet Char"; mso-style-link:bullet;} p.bullet3, li.bullet3, div.bullet3 {mso-style-name:"bullet 3"; mso-style-link:"bullet 3 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; text-indent:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet3CxSpFirst, li.bullet3CxSpFirst, div.bullet3CxSpFirst {mso-style-name:"bullet 3CxSpFirst"; mso-style-link:"bullet 3 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:0in; text-indent:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet3CxSpMiddle, li.bullet3CxSpMiddle, div.bullet3CxSpMiddle {mso-style-name:"bullet 3CxSpMiddle"; mso-style-link:"bullet 3 Char"; margin:0in; text-indent:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet3CxSpLast, li.bullet3CxSpLast, div.bullet3CxSpLast {mso-style-name:"bullet 3CxSpLast"; mso-style-link:"bullet 3 Char"; margin:0in; text-indent:0in; font-size:11.0pt; font-family:"Calibri",sans-serif;} span.bullet3Char {mso-style-name:"bullet 3 Char"; mso-style-link:"bullet 3";} p.bullet4, li.bullet4, div.bullet4 {mso-style-name:"bullet 4"; mso-style-link:"bullet 4 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:1.85in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet4CxSpFirst, li.bullet4CxSpFirst, div.bullet4CxSpFirst {mso-style-name:"bullet 4CxSpFirst"; mso-style-link:"bullet 4 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:1.85in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet4CxSpMiddle, li.bullet4CxSpMiddle, div.bullet4CxSpMiddle {mso-style-name:"bullet 4CxSpMiddle"; mso-style-link:"bullet 4 Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:1.85in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet4CxSpLast, li.bullet4CxSpLast, div.bullet4CxSpLast {mso-style-name:"bullet 4CxSpLast"; mso-style-link:"bullet 4 Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:1.85in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} span.bullet4Char {mso-style-name:"bullet 4 Char"; mso-style-link:"bullet 4";} span.Heading4Char {mso-style-name:"Heading 4 Char"; mso-style-link:"Heading 4"; font-family:"Calibri Light",sans-serif; color:#7030A0; font-style:italic;} span.Heading5Char {mso-style-name:"Heading 5 Char"; mso-style-link:"Heading 5"; font-family:"Calibri Light",sans-serif; color:#2F5496;} span.Heading6Char {mso-style-name:"Heading 6 Char"; mso-style-link:"Heading 6"; font-family:"Calibri Light",sans-serif; color:#00B0F0;} span.Heading7Char {mso-style-name:"Heading 7 Char"; mso-style-link:"Heading 7"; font-family:"Calibri Light",sans-serif; color:#92D050; font-style:italic;} span.Heading8Char {mso-style-name:"Heading 8 Char"; mso-style-link:"Heading 8"; font-family:"Calibri Light",sans-serif; color:#FFC000;} span.TitleChar {mso-style-name:"Title Char"; mso-style-link:Title; font-family:"Calibri Light",sans-serif; letter-spacing:-.5pt;} span.Heading1Char {mso-style-name:"Heading 1 Char"; mso-style-link:"Heading 1"; font-family:"Calibri Light",sans-serif; color:#2F5496;} span.Heading2Char {mso-style-name:"Heading 2 Char"; mso-style-link:"Heading 2"; font-family:"Calibri Light",sans-serif; color:#C45911;} p.bullet5, li.bullet5, div.bullet5 {mso-style-name:"bullet 5"; mso-style-link:"bullet 5 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.75in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet5CxSpFirst, li.bullet5CxSpFirst, div.bullet5CxSpFirst {mso-style-name:"bullet 5CxSpFirst"; mso-style-link:"bullet 5 Char"; margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.75in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet5CxSpMiddle, li.bullet5CxSpMiddle, div.bullet5CxSpMiddle {mso-style-name:"bullet 5CxSpMiddle"; mso-style-link:"bullet 5 Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.75in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} p.bullet5CxSpLast, li.bullet5CxSpLast, div.bullet5CxSpLast {mso-style-name:"bullet 5CxSpLast"; mso-style-link:"bullet 5 Char"; margin-top:0in; margin-right:0in; margin-bottom:0in; margin-left:.75in; text-indent:-.25in; font-size:11.0pt; font-family:"Calibri",sans-serif;} span.bullet5Char {mso-style-name:"bullet 5 Char"; mso-style-link:"bullet 5";} span.SubtitleChar {mso-style-name:"Subtitle Char"; mso-style-link:Subtitle; font-family:"Times New Roman",serif; color:#5A5A5A; letter-spacing:.75pt;} span.Heading9Char {mso-style-name:"Heading 9 Char"; mso-style-link:"Heading 9"; font-family:"Times New Roman",serif; color:#272727;} span.QuoteChar {mso-style-name:"Quote Char"; mso-style-link:Quote; color:#404040; font-style:italic;} span.IntenseQuoteChar {mso-style-name:"Intense Quote Char"; mso-style-link:"Intense Quote"; color:#2F5496; font-style:italic;} span.msoIns {mso-style-name:""; text-decoration:underline; color:teal;} span.msoDel {mso-style-name:""; text-decoration:line-through; color:red;} .MsoChpDefault {font-family:"Calibri",sans-serif;} .MsoPapDefault {margin-top:12.0pt; margin-right:0in; margin-bottom:0in; margin-left:.5in; margin-bottom:.0001pt; text-indent:-.25in;} @page WordSection1 {size:8.5in 11.0in; margin:.5in .5in .5in .5in;} div.WordSection1 {page:WordSection1;} /\* List Definitions \*/ ol {margin-bottom:0in;} ul {margin-bottom:0in;} -->

Contents

[Architectures. 3](#_Toc219409778)

[Why not microservices?. 3](#_Toc219409779)

[Client–Server / 3-Tier Application. 3](#_Toc219409780)

[Cloud-native deployment architecture (container + CI/CD). 3](#_Toc219409781)

[Event-driven concepts (but only _in-process_, not microservices event-driven). 3](#_Toc219409782)

[Layered / “Clean-ish” Architecture (by projects). 4](#_Toc219409783)

[MVVM (UI Architecture in MAUI). 4](#_Toc219409784)

[Ports & Adapters (Hexagonal). 5](#_Toc219409785)

[“REST API (delivery style)” or “HTTP API (Controllers + middleware + DTOs)”. 7](#_Toc219409786)

[Security. 7](#_Toc219409787)

[Design Patterns. 8](#_Toc219409788)

[GoF. 8](#_Toc219409789)

[Adapter (Structural). 8](#_Toc219409790)

[Chain of Responsibility (middleware / handlers) (Behavioral). 9](#_Toc219409791)

[Command (Behavioral). 10](#_Toc219409792)

[Decorator (DelegatingHandler pipeline) (Structural). 11](#_Toc219409793)

[Facade (Structural). 13](#_Toc219409794)

[Factory (Creational). 14](#_Toc219409795)

[Observer (Behavioral). 15](#_Toc219409796)

[Non-GoF. 16](#_Toc219409797)

[Concurrency gate / “single-flight” protection (SemaphoreSlim used as a guard). 16](#_Toc219409798)

[Event Aggregator / In-process Message Bus. 17](#_Toc219409799)

[MVVM + Observer. 18](#_Toc219409800)

[Test patterns: unit tests + fakes/spies. 18](#_Toc219409801)

[Use Case / Application Service. 19](#_Toc219409802)

[Validation + Mapper Patterns. 20](#_Toc219409803)

[Engineering Practices (not design patterns). 21](#_Toc219409804)

[DI / IoC. 21](#_Toc219409805)

[DTO (integration boundary). 22](#_Toc219409806)

[Idempotency. 22](#_Toc219409807)

[Resilience. 23](#_Toc219409808)

Architectures
=============

Why not microservices?
----------------------

My mobile app did not have a microservice architecture because:

·         Single deployable backend service

·         No separate independently deployable domain services

·         Synchronous REST is the main communication style

Client–Server / 3-Tier Application
----------------------------------

**What it is (simple):** A client app talks to a backend API; the backend talks to data stores and cloud services.

**Where you use it:**

*   **Client:** GPSRadius.MAUI (mobile app)
*   **Backend:** GPSRadius.API (ASP.NET Core Web API)
*   **Data + cloud dependencies:** MongoDB + AWS services (Cognito, S3, Secrets Manager, etc.)

**In other words:**

*   “It’s a client-server app: MAUI front-end, ASP.NET Core API, MongoDB, and AWS managed services for auth and storage.”

**Evidence**

*   MAUI app exists: GPSRadius.MAUI/GPSRadius.MAUI.csproj
*   API exists: GPSRadius.API/GPSRadius.API.csproj + GPSRadius.API/Program.cs
*   MongoDB in API: GPSRadius.API/Program.cs (creates MongoClient / MongoDbService)
*   AWS in API: GPSRadius.API/Program.cs (S3 + Secrets Manager + JWT validation)
*   AWS in client: Infrastructure/Services/AwsService.cs (Cognito + tokens + avatar URL)

**What to call it:**

*   “Client–server architecture” or “3-tier architecture (mobile client → REST API → database)”.

Cloud-native deployment architecture (container + CI/CD)
--------------------------------------------------------

**What it is (simple):** You build a Docker image, push to a registry, and a managed runtime deploys it. CI/CD automates this.

**Where you use it:**

*   GitHub Actions pipelines: .github/workflows/deploy.yml, deploy-first.yml, tests.yml
*   API container build: workflow builds using ./GPSRadius.API/Dockerfile
*   Deploy target: **ECR + AWS App Runner** (App Runner auto-deploy enabled in workflow)

**In other words:**

*   “API is containerized and deployed via GitHub Actions → ECR → App Runner, with automated test runs on PRs.”

**Deployment/Operations**

*   Config via Secrets Manager
*   Correlation IDs
*   Rate limiting + global throttling

Event-driven concepts (but only _in-process_, not microservices event-driven)
-----------------------------------------------------------------------------

You _do_ use “events” inside the MAUI app (in-process), but you do **not** have Kafka/RabbitMQ-style distributed event-driven architecture.

**Where you use in-process pub/sub:**

*   GPSRadius.MAUI/Messages/AvatarUpdatedMessage.cs
*   WeakReferenceMessenger.Default.Register/Send(...) in:

*   GPSRadius.MAUI/ViewModels/BusinessShellViewModel.cs
*   GPSRadius.MAUI/Pages/SharedFlyoutTemplate.xaml.cs
*   BusinessUserInfoViewModel.Avatar.cs, CustomerUserInfoViewModel.Avatar.cs

**In other words:**

*   “Inside the mobile app I use an in-process message bus (CommunityToolkit Messenger) to broadcast events like ‘avatar updated’ across pages without tight coupling.”

**Notes**

·         Not Microservices; Not Event-Driven (in this repo)

·         You currently have **one backend service** (GPSRadius.API). There’s no broker, no events, no separate deployable services inside this repo.

**What to say**

*   “It’s a modular system with one backend API service; not microservices yet.”
*   “Communication is synchronous REST, not event-driven.”

Layered / “Clean-ish” Architecture (by projects)
------------------------------------------------

**What it is (simple):** You keep **business logic** in one place (Core), and the app/UI and external services plug into it.

**Where you use it (this is very clear in your project references):**

*   GPSRadius.Core is referenced by **everything**:

*   GPSRadius.API → references GPSRadius.Core
*   Infrastructure → references GPSRadius.Core
*   GPSRadius.MAUI → references GPSRadius.Core and Infrastructure

*   Core contains the “center” concerns:

*   Use-cases: GPSRadius.Core/UseCases/\* (example: BusinessUserSaveUseCase.cs)
*   Validation + logic: GPSRadius.Core/Logic/\*
*   Models/DTOs/errors/utilities: Models, DTOs, Errors, Utils
*   Interfaces (“ports”): GPSRadius.Core/Auth/\* and GPSRadius.Core/Services/\*

**In other words:**

*   “Core holds my use-cases, validation, and models. UI and infrastructure depend on Core, not the other way around. That keeps the business logic testable and portable.”

**Notes**

You have a **clean separation** by project boundaries:

*   **Core (shared app/domain logic):** GPSRadius.Core/
*   **Infrastructure (external integrations + platform services):** Infrastructure/
*   **API (delivery layer for backend):** GPSRadius.API/
*   **UI (delivery layer for mobile):** GPSRadius.MAUI/

This is “Clean-ish” because:

*   Your **interfaces live in Core** (good Clean/Hex practice),
*   Implementations are in MAUI/Infrastructure (good),
*   BUT the **API directly performs DB logic in controllers** (not fully clean—controllers talk to Mongo collections directly, instead of going through repository/service abstractions).

**Evidence**

*   Ports/interfaces in Core: GPSRadius.Core/Auth/\* and GPSRadius.Core/Aws/IAwsService.cs
*   Implementation in Infrastructure: Infrastructure/Services/AwsService.cs
*   API does direct Mongo collection usage: GPSRadius.API/Controllers/\*.cs (e.g., BusinessesController.cs uses \_mongo.GetCollection<T>())

**What to call it**

*   “Layered architecture” or “Clean Architecture style separation (Core + Infrastructure + Delivery layers)”.
*   If you want to be precise: “Clean Architecture principles in the client; the server is layered but not fully clean.”

MVVM (UI Architecture in MAUI)
------------------------------

**What it is (simple):** UI binds to ViewModels; ViewModels expose properties + commands; UI updates automatically.

**Where you use it:**

*   ViewModels: GPSRadius.MAUI/ViewModels/\*
*   Base VM implements property change notifications: GPSRadius.Core/ViewModels/BaseViewModel.cs
*   Commands everywhere: e.g. LoginViewModel, RegisterViewModel, BusinessUserInfoViewModel, etc.

**In other words:**

*   “The MAUI client follows MVVM: XAML binding to ViewModels, using INotifyPropertyChanged + ICommand for UI actions.”

**Notes**

·         Your MAUI app uses **MVVM**: Pages bind to ViewModels; ViewModels expose state + commands.

·         **Why MVVM appears under both “architecture” and “design patterns”**

o   This is a terminology overlap:

§  At the **app level** (how the UI layer is structured), MVVM is an **architectural pattern** for the client UI.

§  At the **pattern level**, MVVM is also commonly discussed as a **design pattern**.

o   So it’s the same concept described from two angles:

§  **Architecture section:** “How your UI is organized.”

§  **Design pattern section:** “The pattern used to organize it.”

o   If you prefer clarity for discussions, I’d keep it in **architecture** and treat related items (Observer, Command) as supporting design patterns.

**Evidence**

*   ViewModels: GPSRadius.MAUI/ViewModels/\*ViewModel.cs
*   Base VM with INotifyPropertyChanged: GPSRadius.Core/ViewModels/BaseViewModel.cs
*   Commands: e.g., GPSRadius.MAUI/ViewModels/LoginViewModel.cs (LoginCommand, ForgotPasswordCommand)

**What to call it**

*   “MVVM in the client UI (MAUI).”

Ports & Adapters (Hexagonal)
----------------------------

**What it is (simple):**

·         Core defines **interfaces** for external things (auth storage, location, AWS), and platform-specific code implements them.

**Concrete examples from your repo:**

*   **Ports in Core (interfaces):**

*   GPSRadius.Core/Auth/ITokenStore.cs
*   GPSRadius.Core/Services/ILocationProvider.cs
*   GPSRadius.Core/Auth/IFileSystemService.cs
*   GPSRadius.Core/Aws/IAwsService (used heavily by use-cases/services)

*   **Adapters in MAUI / Infrastructure (implementations):**

*   GPSRadius.MAUI/Utils/SecureTokenStore.cs (wraps MAUI secure storage)
*   GPSRadius.MAUI/Services/MauiLocationProvider.cs (wraps MAUI geolocation)
*   GPSRadius.MAUI/Services/MauiFileSystemService.cs
*   Infrastructure/Services/AwsService.cs and Infrastructure/Services/AvatarService.cs (AWS SDK work)

**In other words:**

*   “Core defines ports like ITokenStore and ILocationProvider. MAUI and Infrastructure provide adapters. That’s how I keep business logic independent from device APIs and AWS SDK details.”

**Notes**

·         In my example, Ports & Adapters is mostly on the client side.  Server side is more layered; controllers sometimes touch Mongo directly.

·         Ports & Adapters is an architectural style that keeps your core logic independent from external systems (UI frameworks, databases, cloud SDKs, file system, device sensors, etc.).

o   Port = an interface the Core defines for something it needs (e.g., “store a token”, “get location”, “talk to AWS”).

o   Adapter = a concrete implementation of that interface for a specific technology (MAUI SecureStorage, MAUI Geolocation, AWS SDK, MongoDB driver, etc.).

·         Core defines “ports” (interfaces). MAUI/Infrastructure provides “adapters” (platform-specific implementations).

·         Is it “just abstraction”?

o   It uses abstraction, but it is more than “just” abstraction:

§  Abstraction is a language technique (interfaces/classes).

§  Ports & Adapters is a design decision about dependency direction:

·         Core defines the interfaces.

·         The outside world depends on Core to implement them.

·         Core does not depend on MAUI/AWS/Mongo types.

o   The important part is the dependency inversion and replaceability: Core stays testable and portable.

·         Concrete examples from your code

o   Port (Core interface) → Adapter (implementation)

§  Token storage

·         Port: GPSRadius.Core/Auth/ITokenStore.cs

·         Adapter: GPSRadius.MAUI/Utils/SecureTokenStore.cs (wraps MAUI secure storage behind ITokenStore)

§  Location provider

·         Port: GPSRadius.Core/Services/ILocationProvider.cs

·         Adapter: GPSRadius.MAUI/Services/MauiLocationProvider.cs (wraps MAUI geolocation APIs behind ILocationProvider)

§  File system

·         Port: GPSRadius.Core/Auth/IFileSystemService.cs

·         Adapter: GPSRadius.MAUI/Services/MauiFileSystemService.cs

§  AWS integration

·         Port: GPSRadius.Core/Aws/IAwsService.cs

·         Adapter: Infrastructure/Services/AwsService.cs (wraps Cognito, token refresh logic, attribute updates, etc.)

·         How to explain (one sentence)

o   “Core defines ports (interfaces) like ITokenStore and ILocationProvider; MAUI/Infrastructure provides adapters so my business logic doesn’t depend on MAUI or AWS SDKs.”

·          

**Evidence**

*   Ports (interfaces) in Core:

*   GPSRadius.Core/Auth/ITokenStore.cs
*   GPSRadius.Core/Aws/IAwsService.cs
*   GPSRadius.Core/Services/ILocationProvider.cs
*   GPSRadius.Core/Auth/IFileSystemService.cs

*   Adapters in MAUI:

*   GPSRadius.MAUI/Services/SecureTokenStore.cs (implements ITokenStore)
*   GPSRadius.MAUI/Services/MauiLocationProvider.cs (implements ILocationProvider)
*   GPSRadius.MAUI/Services/MauiFileSystemService.cs (implements IFileSystemService)

*   Adapter in Infrastructure:

*   Infrastructure/Services/AwsService.cs (implements IAwsService)

**What to call it**

*   “Ports-and-adapters / Hexagonal architecture (interfaces in Core, platform adapters in MAUI/Infrastructure).”

“REST API (delivery style)” or “HTTP API (Controllers + middleware + DTOs)”
---------------------------------------------------------------------------

**Simple definition:**

·         It’s not a separate “system architecture” from client-server; it’s the **backend delivery style** inside that architecture.

**Notes**

·         You can roll this into the Client-Server / 3-tier architecture section but I left it here to be explicit.

·         Your backend is a standard ASP.NET Core REST API: controllers, routes, DTOs, auth middleware.

**Evidence**

*   Controllers: GPSRadius.API/Controllers/\*.cs
*   JWT auth (Cognito): GPSRadius.API/Program.cs (AddJwtBearer)
*   DTOs: GPSRadius.API/DTOs/\*

Security
--------

**Notes**:

*   JWT bearer auth in API
*   Token storage on device (SecureStorage behind ITokenStore)
*   401/403 refresh + retry once (AuthRefreshingHandler)

Design Patterns
===============

GoF
---

### Adapter (Structural)

**Simple definition:**

·         _Platform-specific_ implementations behind interfaces.

·         Convert one API into an interface your app expects.

**Where it shows:**

*   GPSRadius.MAUI/Services/MauiLocationProvider.cs implements a Core abstraction for geolocation
*   GPSRadius.MAUI/Utils/SecureTokenStore.cs implements token storage behind an interface
*   GPSRadius.MAUI/Services/MauiFileSystemService.cs

**Talking points:**

*   Why: portability, testability, keeps Core clean.

**Notes**

·         Wrap platform APIs so Core doesn’t depend on them

·         Core defines interfaces; MAUI provides platform implementations.

**Evidence**

*   Interfaces in Core:

*   GPSRadius.Core/Auth/ITokenStore.cs, IFileSystemService.cs
*   GPSRadius.Core/Services/ILocationProvider.cs

*   Implementations in MAUI:

*   GPSRadius.MAUI/Services/SecureTokenStore.cs
*   GPSRadius.MAUI/Services/MauiFileSystemService.cs
*   GPSRadius.MAUI/Services/MauiLocationProvider.cs

**Code**

Secure storage adapter

·         **File:** GPSRadius.MAUI/Utils/SecureTokenStore.cs (approx. **L1–L75**)

 1. public class SecureTokenStore : ITokenStore

 2. {

 3.     public Task SaveTokensAsync(string accessToken, string idToken, string refreshToken)

 4.     {

 5.         return Task.WhenAll(

 6.             SecureStorage.SetAsync("access\_token", accessToken),

 7.             SecureStorage.SetAsync("id\_token", idToken),

 8.             SecureStorage.SetAsync("refresh\_token", refreshToken)

 9.         );

10\.     }

11\.  

12\.     public async Task<string> GetAccessTokenAsync()

13\.         \=> await SecureStorage.GetAsync("access\_token");

14\. }

Geolocation adapter

·         **File:** GPSRadius.MAUI/Services/MauiLocationProvider.cs (approx. **L1–L90**)

 1. public class MauiLocationProvider : ILocationProvider

 2. {

 3.     public async Task<LocationResult\> GetCurrentLocationAsync()

 4.     {

 5.         var location \= await Geolocation.GetLastKnownLocationAsync()

 6.                        ?? await Geolocation.GetLocationAsync(new GeolocationRequest(GeolocationAccuracy.Medium));

 7.  

 8.         return new LocationResult(location.Latitude, location.Longitude);

 9.     }

10\. }

Typical Example

 1. // Target interface the app expects

 2. public interface ILocationProvider

 3. {

 4.     (double Lat, double Lng) GetCurrent();

 5. }

 6.  

 7. // Adaptee (incompatible API)

 8. public class MauiGeoApi

 9. {

10\.     public (double Latitude, double Longitude) GetLastKnown() \=> (41.0, \-87.0);

11\. }

12\.  

13\. // Adapter wraps the adaptee to match the target interface

14\. public class MauiLocationProviderAdapter : ILocationProvider

15\. {

16\.     private readonly MauiGeoApi \_api;

17\.     public MauiLocationProviderAdapter(MauiGeoApi api) \=> \_api \= api;

18\.  

19\.     public (double Lat, double Lng) GetCurrent()

20\.     {

21\.         var (latitude, longitude) \= \_api.GetLastKnown();

22\.         return (latitude, longitude);

23\.     }

24\. }

### Chain of Responsibility (middleware / handlers) (Behavioral)

**Simple definition:**

·         Requests flow through a chain of middleware for cross-cutting concerns.

·         Server cross-cutting concerns.

**Where it shows:**

*   GPSRadius.API/Program.cs
*   Custom middleware:

*   GPSRadius.API/Middleware/CorrelationIdMiddleware.cs
*   GPSRadius.API/Middleware/GlobalThrottleMiddleware.cs

**Talking points:**

*   Why: consistent observability (correlation IDs), global request control (throttling), security headers, etc.

**Notes**

·         ASP.NET Core

·         Your API uses middleware to apply cross-cutting behaviors to every request.

**Evidence**

*   Middleware types:

*   GPSRadius.API/Middleware/CorrelationIdMiddleware.cs
*   GPSRadius.API/Middleware/GlobalThrottleMiddleware.cs

*   Middleware registration/order:

*   GPSRadius.API/Program.cs (app.UseMiddleware<CorrelationIdMiddleware>(); etc.)

**Code**

Middleware registration

·         **File:** GPSRadius.API/Program.cs (approx. **L140–L170**)

1\. app.UseMiddleware<CorrelationIdMiddleware\>();

2\. app.UseMiddleware<GlobalThrottleMiddleware\>();

3\.  

4\. app.UseAuthentication();

5\. app.UseAuthorization();

6\.  

7\. app.MapControllers();

Middleware implementation

·         **File:** GPSRadius.API/Middleware/CorrelationIdMiddleware.cs (approx. **L1–L70**)

 1. public class CorrelationIdMiddleware

 2. {

 3.     private readonly RequestDelegate \_next;

 4.  

 5.     public CorrelationIdMiddleware(RequestDelegate next)

 6.     {

 7.         \_next \= next;

 8.     }

 9.  

10\.     public async Task Invoke(HttpContext context)

11\.     {

12\.         var correlationId \= context.Request.Headers\["X-Correlation-Id"\].FirstOrDefault()

13\.                             ?? Guid.NewGuid().ToString();

14\.  

15\.         context.Items\["CorrelationId"\] \= correlationId;

16\.         context.Response.Headers\["X-Correlation-Id"\] \= correlationId;

17\.  

18\.         await \_next(context);

19\.     }

20\. }

Typical Example

 1. public class Request

 2. {

 3.     public string UserId { get; init; }

 4.     public bool IsAuthenticated { get; init; }

 5. }

 6.  

 7. public abstract class Handler

 8. {

 9.     private Handler \_next;

10\.     public Handler SetNext(Handler next) { \_next \= next; return next; }

11\.  

12\.     public void Handle(Request req)

13\.     {

14\.         if (Process(req)) \_next?.Handle(req);

15\.     }

16\.  

17\.     protected abstract bool Process(Request req); // return true = continue

18\. }

19\.  

20\. public class AuthHandler : Handler

21\. {

22\.     protected override bool Process(Request req)

23\.     {

24\.         if (!req.IsAuthenticated) throw new Exception("401 Unauthorized");

25\.         return true;

26\.     }

27\. }

28\.  

29\. public class LoggingHandler : Handler

30\. {

31\.     protected override bool Process(Request req)

32\.     {

33\.         Console.WriteLine($"Request by {req.UserId}");

34\.         return true;

35\.     }

36\. }

37\.  

38\. // Usage:

39\. var chain \= new LoggingHandler();

40\. chain.SetNext(new AuthHandler());

41\.  

42\. chain.Handle(new Request { UserId \= "u1", IsAuthenticated \= true });

### Command (Behavioral)

**Simple definition:**

·         I use them on UI Commands.

·         UI actions are represented as command objects (like “Login”, “Save”, “PickPhoto”).

**Where it shows:**

*   Everywhere in MAUI ViewModels (e.g., LoginViewModel, RegisterViewModel, BusinessUserInfoViewModel, etc.)

**Talking points:**

*   Why: binds button taps directly to logic; supports “can execute” enable/disable patterns.

**Notes**

·         ICommand

·         Your ViewModels expose commands that the UI triggers.

**Evidence**

*   GPSRadius.MAUI/ViewModels/LoginViewModel.cs

*   LoginCommand = new Command(async () => await LoginAsync(), ...)
*   ForgotPasswordCommand = new Command(async () => ...)

**Code**

·         **File:** GPSRadius.MAUI/ViewModels/LoginViewModel.cs (approx. **L20–L65**)

 1. public Command LoginCommand { get; }

 2. public Command ForgotPasswordCommand { get; }

 3.  

 4. public LoginViewModel(

 5.     ITokenStore tokenStore,

 6.     IAwsService awsService,

 7.     ILogger<LoginViewModel\> logger,

 8.     SessionManager sessionManager)

 9. {

10\.     \_tokenStore \= tokenStore;

11\.     \_awsService \= awsService;

12\.     \_logger \= logger;

13\.     \_sessionManager \= sessionManager;

14\.  

15\.     LoginCommand \= new Command(async () \=> await LoginAsync(), () \=> !IsBusy);

16\.     ForgotPasswordCommand \= new Command(async () \=> await ForgotPasswordAsync(), () \=> !IsBusy);

17\. }

Typical Example

 1. public interface ICommand

 2. {

 3.     void Execute();

 4. }

 5.  

 6. public class SaveProfileCommand : ICommand

 7. {

 8.     private readonly Action \_action;

 9.  

10\.     public SaveProfileCommand(Action action) \=> \_action \= action;

11\.  

12\.     public void Execute() \=> \_action();

13\. }

14\.  

15\. // Invoker (e.g., UI button)

16\. public class Button

17\. {

18\.     private readonly ICommand \_command;

19\.     public Button(ICommand command) \=> \_command \= command;

20\.  

21\.     public void Click() \=> \_command.Execute();

22\. }

### Decorator (DelegatingHandler pipeline) (Structural)

**Simple definition:**

·         Wrap and add behavior.

·         **Resembles CoR** because it’s a handler chain.

·         HTTP Pipeline Handler + Concurrency Gate (“single-flight” refresh)

**Why it matters:** It adds behavior around HTTP calls (auth headers, refresh, retry) without changing every API call site.

**Concrete example:**

*   GPSRadius.MAUI/Services/AuthRefreshingHandler.cs is a DelegatingHandler that:

*   attaches bearer tokens to requests
*   on auth failure (e.g., 401/403), refreshes tokens and retries once (guarded to avoid stampedes)

This is often described as **Decorator** (wrap behavior) or **Chain of Responsibility** (handler pipeline).

**Notes**

·         AuthRefreshingHandler is a **DelegatingHandler** that wraps HTTP calls to:

·         attach bearer token

·         on 401/403: refresh session once and retry

**Evidence**

*   GPSRadius.MAUI/Services/AuthRefreshingHandler.cs
*   Wired into API clients: GPSRadius.MAUI/MauiProgram.cs uses ApiConfig.CreateHttpClient(handler)

This is an excellent “real-world” pattern to discuss.

**Code**

**File:** GPSRadius.MAUI/Services/AuthRefreshingHandler.cs (approx. **L1–L170**)

 1. public class AuthRefreshingHandler : DelegatingHandler

 2. {

 3.     private readonly ITokenStore \_tokenStore;

 4.     private readonly IAwsService \_awsService;

 5.     private static readonly SemaphoreSlim \_refreshLock \= new(1, 1);

 6.  

 7.     public AuthRefreshingHandler(ITokenStore tokenStore, IAwsService awsService)

 8.     {

 9.         \_tokenStore \= tokenStore;

10\.         \_awsService \= awsService;

11\.     }

12\.  

13\.     protected override async Task<HttpResponseMessage\> SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)

14\.     {

15\.         var accessToken \= await \_tokenStore.GetAccessTokenAsync();

16\.         if (!string.IsNullOrWhiteSpace(accessToken))

17\.         {

18\.             request.Headers.Authorization \= new AuthenticationHeaderValue("Bearer", accessToken);

19\.         }

20\.  

21\.         var response \= await base.SendAsync(request, cancellationToken);

22\.  

23\.         if (response.StatusCode \== HttpStatusCode.Unauthorized || response.StatusCode \== HttpStatusCode.Forbidden)

24\.         {

25\.             await \_refreshLock.WaitAsync(cancellationToken);

26\.             try

27\.             {

28\.                 await \_awsService.RefreshSessionAsync();

29\.             }

30\.             finally

31\.             {

32\.                 \_refreshLock.Release();

33\.             }

34\.  

35\.             // retry once after refresh

36\.             var retry \= request.Clone();

37\.             var newToken \= await \_tokenStore.GetAccessTokenAsync();

38\.             retry.Headers.Authorization \= new AuthenticationHeaderValue("Bearer", newToken);

39\.  

40\.             return await base.SendAsync(retry, cancellationToken);

41\.         }

42\.  

43\.         return response;

44\.     }

45\. }

Typical Example

 1. public interface IBusinessApi

 2. {

 3.     Task<string> GetBusinessAsync(string id);

 4. }

 5.  

 6. // Concrete component

 7. public class BusinessApi : IBusinessApi

 8. {

 9.     public Task<string> GetBusinessAsync(string id) \=> Task.FromResult($"Business:{id}");

10\. }

11\.  

12\. // Decorator base

13\. public abstract class BusinessApiDecorator : IBusinessApi

14\. {

15\.     protected readonly IBusinessApi Inner;

16\.  

17\.     protected BusinessApiDecorator(IBusinessApi inner) \=> Inner \= inner;

18\.  

19\.     public virtual Task<string> GetBusinessAsync(string id) \=> Inner.GetBusinessAsync(id);

20\. }

21\.  

22\. // Concrete decorator adds behavior (logging)

23\. public class LoggingBusinessApi : BusinessApiDecorator

24\. {

25\.     public LoggingBusinessApi(IBusinessApi inner) : base(inner) {}

26\.  

27\.     public override async Task<string> GetBusinessAsync(string id)

28\.     {

29\.         Console.WriteLine($"Fetching business {id}");

30\.         var result \= await base.GetBusinessAsync(id);

31\.         Console.WriteLine($"Done fetching business {id}");

32\.         return result;

33\.     }

34\. }

### Facade (Structural)

**Simple definition:**

·         Wrap complex subsystems behind a simpler API

·         One class provides a simpler interface over many AWS calls / rules / steps.

·         Facade / Gateway

**Where it shows:**

*   Infrastructure/Services/AwsService.cs (Cognito flows, refresh, attributes, etc.)
*   Infrastructure/Services/AvatarService.cs (S3 + local caching rules)
*   GPSRadius.Core/Services/BusinessApiClient.cs (HTTP API wrapper)

**Talking points:**

*   Why: keep ViewModels/use-cases clean; hide AWS/HTTP complexity in dedicated services.

**Notes**

·         Wrapping complex AWS flows

·         AwsService hides Cognito + token refresh + avatar URL generation behind one interface.

**Evidence**

*   Infrastructure/Services/AwsService.cs implements IAwsService and coordinates:

*   Cognito auth / refresh
*   token storage (ITokenStore)
*   avatar service (IAvatarService)
*   session state (ISessionManager)

**Code**

**File:** Infrastructure/Services/AwsService.cs (approx. **L1–L90**)

 1. public class AwsService : IAwsService

 2. {

 3.     private readonly ITokenStore \_tokenStore;

 4.     private readonly IAvatarService \_avatarService;

 5.     private readonly ISessionManager \_sessionManager;

 6.  

 7.     public AwsService(

 8.         ITokenStore tokenStore,

 9.         IAvatarService avatarService,

10\.         ISessionManager sessionManager)

11\.     {

12\.         \_tokenStore \= tokenStore;

13\.         \_avatarService \= avatarService;

14\.         \_sessionManager \= sessionManager;

15\.     }

16\.  

17\.     public async Task<AuthResult\> SignInAsync(string email, string password)

18\.     {

19\.         // Cognito sign-in flow...

20\.     }

21\.  

22\.     public async Task RefreshSessionAsync()

23\.     {

24\.         // Refresh token flow...

25\.     }

26\. }

Typical Example

 1. // Subsystems

 2. public class CognitoClient { public Task<string> SignInAsync(string u, string p) \=> Task.FromResult("token"); }

 3. public class TokenStore { public Task SaveAsync(string token) \=> Task.CompletedTask; }

 4. public class AvatarClient { public Task<string> GetUrlAsync() \=> Task.FromResult("https://avatar"); }

 5.  

 6. // Facade provides a simple API over multiple subsystems

 7. public class AuthFacade

 8. {

 9.     private readonly CognitoClient \_cognito;

10\.     private readonly TokenStore \_store;

11\.     private readonly AvatarClient \_avatar;

12\.  

13\.     public AuthFacade(CognitoClient cognito, TokenStore store, AvatarClient avatar)

14\.     {

15\.         \_cognito \= cognito; \_store \= store; \_avatar \= avatar;

16\.     }

17\.  

18\.     public async Task<(string Token, string AvatarUrl)> LoginAsync(string user, string pass)

19\.     {

20\.         var token \= await \_cognito.SignInAsync(user, pass);

21\.         await \_store.SaveAsync(token);

22\.         var avatarUrl \= await \_avatar.GetUrlAsync();

23\.         return (token, avatarUrl);

24\.     }

25\. }

### Factory (Creational)

**Simple definition:**

·         Construction logic centralized.

**Why it matters:** You centralize complex “how to build this client/service” logic in one place (DI registration lambdas act like factories).

**Concrete examples:**

*   In GPSRadius.MAUI/MauiProgram.cs, you construct API clients via DI lambdas (factory-like):

*   build HttpClient with handlers
*   then build BusinessApiClient / CustomerApiClient etc.

*   GPSRadius.Core/Utils/ApiConfig.cs also centralizes “create configured HttpClient” logic.

This is a practical “factory” approach common in DI-based .NET apps.

**Notes**

·         You create complex objects (like API clients with handlers) via factory lambdas.

**Evidence**

*   GPSRadius.MAUI/MauiProgram.cs:

*   builder.Services.AddSingleton<BusinessApiClient>(sp => { ... return new BusinessApiClient(httpClient, logger); });

*   Also ApiConfig.CreateHttpClient(handler) in GPSRadius.Core/Utils/ApiConfig.cs (centralized creation)

**Code**

HttpClient factory method

·         **File:** GPSRadius.Core/Utils/ApiConfig.cs (approx. **L1–L120**)

·         This is not always a textbook Factory Method.

o   The ApiConfig.CreateHttpClient(...) is basically a **Simple Factory** (common term, not GoF).

o   DI registration lambdas are “factory-like construction via the container.”

o   In other words: “Factory-style creation via DI + a centralized HttpClient factory helper.”

 1. public static class ApiConfig

 2. {

 3.     public static HttpClient CreateHttpClient(DelegatingHandler handler)

 4.     {

 5.         handler.InnerHandler \= new HttpClientHandler();

 6.  

 7.         var client \= new HttpClient(handler);

 8.         client.BaseAddress \= new Uri(BaseUrl);

 9.         client.Timeout \= TimeSpan.FromSeconds(30);

10\.  

11\.         return client;

12\.     }

13\. }

(Your DI lambdas in MauiProgram.cs are also “factory-like” construction, shown earlier.)

Typical Example

 1. public interface IApiClient

 2. {

 3.     string BaseUrl { get; }

 4. }

 5.  

 6. public class BusinessApiClient : IApiClient

 7. {

 8.     public string BaseUrl { get; }

 9.     public BusinessApiClient(string baseUrl) \=> BaseUrl \= baseUrl;

10\. }

11\.  

12\. // Creator defines factory method

13\. public abstract class ApiClientFactory

14\. {

15\.     public abstract IApiClient Create(string baseUrl);

16\. }

17\.  

18\. // Concrete creator decides which concrete product to instantiate

19\. public class BusinessApiClientFactory : ApiClientFactory

20\. {

21\.     public override IApiClient Create(string baseUrl) \=> new BusinessApiClient(baseUrl);

22\. }

### Observer (Behavioral)

**Simple definition:**

·         I use it with INotifyPropertyChanged.

·         When a property changes, the UI gets notified and refreshes.

**Where it shows:**

*   GPSRadius.Core/ViewModels/BaseViewModel.cs
*   Many OnPropertyChanged(...) calls across ViewModels

**Talking points:**

*   Why: automatic UI refresh; avoids manual UI updates.

**Code**

·         **File:** GPSRadius.Core\\ViewModels\\BaseViewModel.cs

 1. using System.ComponentModel;

 2. using System.Runtime.CompilerServices;

 3.  

 4. namespace GPSRadius.Core.ViewModels

 5. {

 6.     public abstract class BaseViewModel : INotifyPropertyChanged

 7.     {

 8.         public event PropertyChangedEventHandler PropertyChanged;

 9.  

10\.         protected void OnPropertyChanged(\[CallerMemberName\] string name \= ““) \=>

11\.             PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

12\.  

13\.         protected bool SetProperty<T\>(ref T backing, T value, \[CallerMemberName\] string name \= ““)

14\.         {

15\.             if (EqualityComparer<T\>.Default.Equals(backing, value)) return false;

16\.             backing \= value;

17\.             OnPropertyChanged(name);

18\.             return true;

19\.         }

20\.     }

21\. }

**Why this is Observer:** the UI (subscriber) listens to PropertyChanged events; the ViewModel (publisher) raises notifications when state changes.

Typical Example

 1. public interface IObserver { void Update(int newValue); }

 2.  

 3. public class Subject

 4. {

 5.     private readonly List<IObserver\> \_observers \= new();

 6.     private int \_value;

 7.  

 8.     public void Attach(IObserver observer) \=> \_observers.Add(observer);

 9.     public void Detach(IObserver observer) \=> \_observers.Remove(observer);

10\.  

11\.     public void SetValue(int value)

12\.     {

13\.         \_value \= value;

14\.         foreach (var o in \_observers) o.Update(\_value);

15\.     }

16\. }

17\.  

18\. public class ConsoleObserver : IObserver

19\. {

20\.     public void Update(int newValue) \=> Console.WriteLine($"Value changed to {newValue}");

21\. }

Non-GoF
-------

### Concurrency gate / “single-flight” protection (SemaphoreSlim used as a guard)

**Simple definition:** Ensure only one critical operation runs at a time.

**Where it shows:**

*   AuthRefreshingHandler refresh gate prevents multiple concurrent token refresh attempts
*   ShellRootSwitcher switch gate prevents UI root swaps from overlapping (ShellRootSwitcher.cs)

**Talking points:**

*   Why: prevents race conditions and platform crashes (especially on Android).

**Code**

**File:** GPSRadius.MAUI/Services/ShellRootSwitcher.cs (approx. **L1–L140**)

 1. public class ShellRootSwitcher

 2. {

 3.     private static readonly SemaphoreSlim \_switchLock \= new(1, 1);

 4.  

 5.     public static async Task SwitchToAsync(Func<Page\> createRootPage)

 6.     {

 7.         await \_switchLock.WaitAsync();

 8.         try

 9.         {

10\.             Application.Current.MainPage \= createRootPage();

11\.         }

12\.         finally

13\.         {

14\.             \_switchLock.Release();

15\.         }

16\.     }

17\. }

### Event Aggregator / In-process Message Bus

**Simple definition:**

·         I use them with CommunityToolkit Messenger.

·         One part of the app broadcasts a message; subscribers react. No direct references needed.

**Where it shows:**

*   AvatarUpdatedMessage
*   WeakReferenceMessenger.Default.Send(...) and .Register(...)

**Talking points:**

*   Why: decouple pages/view-models; avoid tight coupling and navigation spaghetti.

**Code**

Message type

·         **File:** GPSRadius.MAUI/Messages/AvatarUpdatedMessage.cs (approx. **L1–L14**)

 1. namespace GPSRadius.MAUI.Messages

 2. {

 3.     public class AvatarUpdatedMessage

 4.     {

 5.         public string NewAvatarUrl { get; }

 6.  

 7.         public AvatarUpdatedMessage(string newAvatarUrl)

 8.         {

 9.             NewAvatarUrl \= newAvatarUrl;

10\.         }

11\.     }

12\. }

Register (subscribe) to messages

·         **File:** GPSRadius.MAUI/ViewModels/BusinessShellViewModel.cs (approx. **L25–L55**)

1\. WeakReferenceMessenger.Default.Register<AvatarUpdatedMessage\>(this, async (r, message) \=>

2\. {

3\.     AvatarUrl \= message.NewAvatarUrl;

4\.     await LoadAvatarAsync();

5\. });

Send (publish) a message

·         **File:** GPSRadius.MAUI/ViewModels/BusinessUserInfoViewModel.Avatar.cs (approx. **L120–L145**)

1\. // Broadcast update to shell/flyout

2\. WeakReferenceMessenger.Default.Send(new AvatarUpdatedMessage(AvatarUrl));

### MVVM + Observer

**Simple definition:** ViewModel is the “UI logic” layer; XAML binds to it; keeps UI code-behind minimal.

**Where it shows:**

*   GPSRadius.MAUI/ViewModels/\*
*   GPSRadius.Core/ViewModels/BaseViewModel.cs
*   Commands: new Command(...) across many VMs

**Talking points:**

*   Why: clean separation of UI and logic, easier state management, improved unit testing.

**Notes**

*   **MVVM**: ViewModels hold state and logic; Views bind.
*   **Observer**: INotifyPropertyChanged notifies UI of changes.
*   **Observer vs MVVM — do they go together, and how do they differ?**

*   **Do they go together?**

*   Yes. MVVM in .NET UI frameworks typically relies on **Observer-style notifications** so the View can react to ViewModel changes.

*   **How they differ (simple)**

*   **MVVM** answers: “Where do UI state and UI logic live?” (in ViewModels, bound to Views)
*   **Observer** answers: “How does the View learn something changed?” (notify subscribers when properties change)

*   **In your code:**

*   MVVM: GPSRadius.MAUI/ViewModels/\*
*   Observer mechanism: GPSRadius.Core/ViewModels/BaseViewModel.cs with INotifyPropertyChanged

**Evidence**

*   GPSRadius.Core/ViewModels/BaseViewModel.cs (INotifyPropertyChanged)
*   GPSRadius.MAUI/ViewModels/\*.cs

### Test patterns: unit tests + fakes/spies

**Simple definition:** Replace real network dependencies with fakes in tests.

**Where it shows:**

*   GPSRadius.MAUI.Tests/Infrastructure/FakeHttpMessageHandler.cs (fake + request capture = spy behavior)
*   Many unit tests around Core logic/use-cases

**Talking points:**

*   Why: fast tests, deterministic outcomes, validates edge cases.

**Code**

**File:** GPSRadius.MAUI.Tests/Infrastructure/FakeHttpMessageHandler.cs (approx. **L1–L200**)

 1. public class FakeHttpMessageHandler : HttpMessageHandler

 2. {

 3.     public List<HttpRequestMessage\> Requests { get; } \= new();

 4.  

 5.     private readonly Func<HttpRequestMessage, HttpResponseMessage\> \_handler;

 6.  

 7.     public FakeHttpMessageHandler(Func<HttpRequestMessage, HttpResponseMessage\> handler)

 8.     {

 9.         \_handler \= handler;

10\.     }

11\.  

12\.     protected override Task<HttpResponseMessage\> SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)

13\.     {

14\.         Requests.Add(request);

15\.         return Task.FromResult(\_handler(request));

16\.     }

17\. }

### Use Case / Application Service

**Simple definition:**

·         Clean Architecture “Interactors”.

·         A “use case” class represents one user workflow (load profile, save profile, get location).

**Where it shows:**

*   GPSRadius.Core/UseCases/BusinessUserSaveUseCase.cs (excellent example)
*   Additional use-cases in GPSRadius.Core/UseCases/\*

**Talking points:**

*   What to emphasize:

*   Validation first
*   Then external calls (Cognito update, token store update, API save)
*   Then map errors to user-friendly results

*   Why: keeps workflows testable and consistent, reduces ViewModel complexity.

**Notes**

·         Use Case / Interactor pattern (application workflows live in Core)

·         You have explicit “use case” classes that orchestrate workflows.

**Evidence**

*   GPSRadius.Core/UseCases/BusinessUserSaveUseCase.cs
*   GPSRadius.Core/UseCases/BusinessUserLoadUseCase.cs
*   GPSRadius.Core/UseCases/CustomerUserLoadUseCase.cs
*   GPSRadius.Core/UseCases/GetCurrentLocationUseCase.cs

This is a strong point for dicussions: it’s clean separation of “what the app does” from UI.

**Code**

**File:** GPSRadius.Core/UseCases/BusinessUserSaveUseCase.cs (approx. **L1–L90**)

 1. public class BusinessUserSaveUseCase

 2. {

 3.     private readonly IAwsService \_aws;

 4.     private readonly ITokenStore \_tokenStore;

 5.     private readonly IBusinessUserService \_businessUserService;

 6.  

 7.     public BusinessUserSaveUseCase(

 8.         IAwsService aws,

 9.         ITokenStore tokenStore,

10\.         IBusinessUserService businessUserService)

11\.     {

12\.         \_aws \= aws;

13\.         \_tokenStore \= tokenStore;

14\.         \_businessUserService \= businessUserService;

15\.     }

16\.  

17\.     public async Task<Result\> ExecuteAsync(BusinessUserDraft draft)

18\.     {

19\.         var validateResult \= BusinessUserSaveValidator.Validate(draft);

20\.         if (!validateResult.Success)

21\.             return validateResult;

22\.  

23\.         // Update Cognito attributes

24\.         await \_aws.UpdateBusinessUserAttributesAsync(draft);

25\.  

26\.         // Persist to API/DB via service

27\.         await \_businessUserService.SaveAsync(draft);

28\.  

29\.         return Result.Ok();

30\.     }

31\. }

### Validation + Mapper Patterns

**Simple definition:** Validate inputs in one place so rules are consistent and testable.

**Where it shows:**

*   GPSRadius.Core/Logic/BusinessUserSaveValidator.cs (used by BusinessUserSaveUseCase)
*   Other validators in GPSRadius.Core/Logic/\*

**Talking points:**

*   Why: avoids duplicated rules in UI; easy to unit test.

**Notes**

·         Validation pattern (centralized validators)

·         You have explicit validators and mappers/hydrators to normalize data.

**Evidence**

*   Validators:

*   GPSRadius.Core/Logic/BusinessUserSaveValidator.cs
*   GPSRadius.Core/Logic/BusinessUserValidator.cs

*   Mapping/Hydration:

*   GPSRadius.Core/Logic/BusinessUserDraftMapper.cs
*   GPSRadius.Core/Logic/BusinessUserHydrator.cs

**Code**

Validation

·         **File:** GPSRadius.Core/Logic/BusinessUserSaveValidator.cs (approx. **L1–L140**)

 1. public static class BusinessUserSaveValidator

 2. {

 3.     public static Result Validate(BusinessUserDraft draft)

 4.     {

 5.         if (draft \== null)

 6.             return Result.Fail("Draft is required.");

 7.  

 8.         if (string.IsNullOrWhiteSpace(draft.BusinessName))

 9.             return Result.Fail("Business name is required.");

10\.  

11\.         if (string.IsNullOrWhiteSpace(draft.Phone))

12\.             return Result.Fail("Phone is required.");

13\.  

14\.         return Result.Ok();

15\.     }

16\. }

Mapper

·         **File:** GPSRadius.Core/Logic/BusinessUserDraftMapper.cs (approx. **L1–L170**)

 1. public static class BusinessUserDraftMapper

 2. {

 3.     public static BusinessDto ToDto(BusinessUserDraft draft, string userId)

 4.     {

 5.         return new BusinessDto

 6.         {

 7.             OwnerUserId \= userId,

 8.             BusinessName \= draft.BusinessName,

 9.             Phone \= draft.Phone,

10\.             AvatarUrl \= draft.AvatarUrl

11\.         };

12\.     }

13\. }

Engineering Practices (not design patterns)
===========================================

DI / IoC
--------

**Simple definition:**

·         Instead of new everywhere, dependencies are provided (injected), so code is easier to test and swap.

·         architectural principle / technique

**Where it shows:**

*   API wiring in GPSRadius.API/Program.cs (AddSingleton, etc.)
*   MAUI wiring likely in MauiProgram.cs (service registration)
*   Core uses constructor injection heavily (example: BusinessUserSaveUseCase takes IAwsService, ITokenStore, IBusinessUserService)

**Talking points:**

*   Why: testability, swap implementations (real vs fake), isolates platform/AWS details behind interfaces.

**Notes**

·         You rely heavily on DI to wire services and ViewModels.

**Evidence**

*   MAUI DI registrations: GPSRadius.MAUI/MauiProgram.cs
*   API DI registrations: GPSRadius.API/Program.cs
*   Constructor injection everywhere (e.g., LoginViewModel, AwsService, BusinessesController)

**Code**

API DI registrations

·         **File:** GPSRadius.API/Program.cs (approx. L27–L69)

 1. // ✅ AWS + Mongo services

 2. builder.Services.AddDefaultAWSOptions(builder.Configuration.GetAWSOptions());

 3. builder.Services.AddAWSService<IAmazonS3\>();

 4. builder.Services.AddAWSService<IAmazonSecretsManager\>();

 5.  

 6. // ✅ Register AwsSecretsService (fetches Mongo URI & Cognito config securely)

 7. builder.Services.AddSingleton<AwsSecretsService\>();

 8.  

 9. // ✅ Build MongoDbService using AwsSecretsService (secret or local)

10\. builder.Services.AddSingleton<MongoDbService\>(sp \=>

11\. {

12\.     var secretsService \= sp.GetRequiredService<AwsSecretsService\>();

13\.  

14\.     try

15\.     {

16\.         var config \= secretsService.GetConfig();

17\.  

18\.         var mongoUri \= config\[“MONGO\_URI”\];

19\.         if (string.IsNullOrEmpty(mongoUri))

20\.             throw new Exception(“❌ MongoDB connection string could not be retrieved.”);

21\.  

22\.         var client \= new MongoClient(mongoUri);

23\.         var databaseName \= “GPSRadius”; // ✅ Hardcoded or you can fetch from secret JSON if needed

24\.         var db \= client.GetDatabase(databaseName);

25\.  

26\.         Console.WriteLine(“✅ MongoDB connected successfully.”);

27\.         return new MongoDbService(db);

28\.     }

29\.     catch (Exception ex)

30\.     {

31\.         Console.WriteLine($”❌ Failed to initialize MongoDB: {ex.Message}”);

32\.         throw;

33\.     }

34\. });

MAUI DI registrations + factory-lambda construction

·         **File:** GPSRadius.MAUI/MauiProgram.cs (approx. **L55–L97**)

 1. // API clients (with centralized auth-refresh + 401 handling)

 2. builder.Services.AddTransient<AuthRefreshingHandler\>();

 3.  

 4. builder.Services.AddSingleton<BusinessApiClient\>(sp \=>

 5. {

 6.     var handler \= sp.GetRequiredService<AuthRefreshingHandler\>();

 7.     var httpClient \= ApiConfig.CreateHttpClient(handler);

 8.     var logger \= sp.GetRequiredService<ILogger<BusinessApiClient\>>();

 9.     return new BusinessApiClient(httpClient, logger);

10\. });

11\.  

12\. builder.Services.AddSingleton<CustomerApiClient\>(sp \=>

13\. {

14\.     var handler \= sp.GetRequiredService<AuthRefreshingHandler\>();

15\.     var httpClient \= ApiConfig.CreateHttpClient(handler);

16\.     var logger \= sp.GetRequiredService<ILogger<CustomerApiClient\>>();

17\.     return new CustomerApiClient(httpClient, logger);

18\. });

DTO (integration boundary)
--------------------------

**Simple definition:**

·         Explicit request/response models.

·         API payloads are kept in DTOs, and mapping/creation is separated from UI models.

**Where it shows:**

*   GPSRadius.Core/DTOs/\*
*   BusinessUserLogic.BuildBusinessDto(...)
*   Hydration helpers like BusinessUserHydrator

**Talking points:**

*   Why: keeps network contracts stable and separate from UI/domain shape.

**Notes**

·         DTO + Mapping pattern

·         You use DTOs to keep transport models separate from internal logic.

**Evidence**

*   Client/shared DTOs: GPSRadius.Core/DTOs/\*.cs
*   API DTOs: GPSRadius.API/DTOs/\*.cs

**Code**

**File:** GPSRadius.Core/DTOs/BusinessDtos.cs (approx. **L1–L90**)

 1. namespace GPSRadius.Core.DTOs

 2. {

 3.     public class BusinessDto

 4.     {

 5.         public string BusinessId { get; set; }

 6.         public string OwnerUserId { get; set; }

 7.         public string BusinessName { get; set; }

 8.         public string Phone { get; set; }

 9.         public string AvatarUrl { get; set; }

10\.     }

11\. }

Idempotency
-----------

**Simple definition:**

·         Some endpoints behave safely on repeats.

·         API design principle / reliability practice.

**Why it matters:** APIs should behave safely if the same request is sent twice (network retries happen).

**Concrete example:**

*   GPSRadius.API/Controllers/BusinessesController.cs delete behavior returns NoContent() even if the item is already gone. That’s idempotent delete semantics.

Also, many PUT-style updates can be idempotent depending on implementation (set state to X, repeated calls keep state at X). The delete example is the clearest.

**Notes**

·         Your delete endpoint is intentionally idempotent in at least one place.

**Evidence**

*   GPSRadius.API/Controllers/BusinessesController.cs:

*   If business already gone, returns NoContent() instead of error.

**Code**

**File:** GPSRadius.API/Controllers/BusinessesController.cs (approx. **L190–L250**)

 1. \[HttpDelete("{businessId}")\]

 2. public async Task<IActionResult\> DeleteBusiness(string businessId)

 3. {

 4.     var collection \= \_mongo.GetCollection<Business\>("Businesses");

 5.  

 6.     var result \= await collection.DeleteOneAsync(b \=> b.BusinessId \== businessId);

 7.  

 8.     if (result.DeletedCount \== 0)

 9.         return NoContent(); // idempotent: deleting something that isn't there is still "success"

10\.  

11\.     return NoContent();

12\. }

Resilience
----------

**Simple definition:**

·         Rate limiting, retries, and bulkheads.

·         Reliability patterns.

**Where**

You have several “production-style” resilience patterns:

1.       **Rate limiting (token bucket)**

*   **Where:** GPSRadius.API/Program.cs uses PartitionedRateLimiter + TokenBucketRateLimiterOptions
*   **How to describe:** “Server enforces fair usage and protects itself from bursts.”

2.       **Bulkhead / concurrency limiting**

*   **Where:** GPSRadius.API/Middleware/GlobalThrottleMiddleware.cs uses SemaphoreSlim to cap concurrent requests
*   **How to describe:** “Prevents the API from being overwhelmed; protects downstream resources.”

3.       **Retry with exponential backoff + jitter (client-side in tests)**

*   **Where:** GPSRadius.IntegrationTests/Http/Retry429Handler.cs
*   **How to describe:** “On 429, retry a few times with backoff and jitter; also client-side pacing to avoid hammering the API.”

4.       **Auth refresh + retry once (HTTP pipeline)**

*   **Where:** GPSRadius.MAUI/Services/AuthRefreshingHandler.cs (DelegatingHandler)
*   **How to describe:** “Automatically attaches latest token; on 401/403 refreshes session once and retries safely.”

**Notes**

·         Retry / Resilience Patterns (simple but present)

·         You include retry/backoff behavior in a few places.

**Evidence**

*   Exponential backoff in reachability: Infrastructure/Services/AwsService.cs (Task.Delay(TimeSpan.FromSeconds(Math.Pow(2, attempt))))
*   Dedicated helper exists: GPSRadius.Core/Utils/RetryHelper.cs
*   One-time retry after refresh: GPSRadius.MAUI/Services/AuthRefreshingHandler.cs

**Code**

Rate limiting

·         **File:** GPSRadius.API/Program.cs (approx. **L80–L160**)

 1. builder.Services.AddRateLimiter(options \=>

 2. {

 3.     options.AddPolicy("Global", context \=>

 4.     {

 5.         return RateLimitPartition.GetTokenBucketLimiter(

 6.             partitionKey: "global",

 7.             factory: key \=> new TokenBucketRateLimiterOptions

 8.             {

 9.                 TokenLimit \= 60,

10\.                 TokensPerPeriod \= 60,

11\.                 ReplenishmentPeriod \= TimeSpan.FromSeconds(30),

12\.                 QueueProcessingOrder \= QueueProcessingOrder.OldestFirst,

13\.                 QueueLimit \= 0,

14\.                 AutoReplenishment \= true

15\.             });

16\.     });

17\. });

18\.  

19\. app.UseRateLimiter();

Bulkhead / global throttle

·         **File:** GPSRadius.API/Middleware/GlobalThrottleMiddleware.cs (approx. **L1–L110**)

 1. public class GlobalThrottleMiddleware

 2. {

 3.     private readonly RequestDelegate \_next;

 4.     private static readonly SemaphoreSlim \_semaphore \= new(25); // max concurrent requests

 5.  

 6.     public GlobalThrottleMiddleware(RequestDelegate next)

 7.     {

 8.         \_next \= next;

 9.     }

10\.  

11\.     public async Task Invoke(HttpContext context)

12\.     {

13\.         await \_semaphore.WaitAsync();

14\.         try

15\.         {

16\.             await \_next(context);

17\.         }

18\.         finally

19\.         {

20\.             \_semaphore.Release();

21\.         }

22\.     }

23\. }

Retry with backoff (in integration tests)

·         **File:** GPSRadius.IntegrationTests/Http/Retry429Handler.cs (approx. **L1–L150**)

 1. public class Retry429Handler : DelegatingHandler

 2. {

 3.     private const int MaxAttempts \= 3;

 4.  

 5.     protected override async Task<HttpResponseMessage\> SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)

 6.     {

 7.         for (var attempt \= 1; attempt <= MaxAttempts; attempt++)

 8.         {

 9.             var response \= await base.SendAsync(request, cancellationToken);

10\.  

11\.             if (response.StatusCode != HttpStatusCode.TooManyRequests)

12\.                 return response;

13\.  

14\.             var delayMs \= (int)Math.Pow(2, attempt \- 1) \* 250; // 250, 500, 1000... (exponential backoff)

15\.             var jitter \= \_rand.Next(0, 150);

16\.             await Task.Delay(delayMs + jitter, cancellationToken);

17\.         }

18\.  

19\.         return await base.SendAsync(request, cancellationToken);

20\.     }

21\. }